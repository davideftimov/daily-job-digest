<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jobs</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body class="min-h-screen bg-zinc-900 text-gray-100">

  <div id="comments-container" class="max-w-7xl mx-auto p-4">
    <p id="loading" class="text-center text-lg">Loading comments...</p>
    <p id="error" class="text-center text-red-500 hidden"></p>
    <p id="jobs-count" class="text-zinc-200 mb-4 hidden"></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const commentsContainer = document.getElementById('comments-container');
      const loadingMessage = document.getElementById('loading');
      const errorMessage = document.getElementById('error');
      const jobsCount = document.getElementById('jobs-count');

      async function fetchComments() {
        try {
          const response = await fetch("http://127.0.0.1:8000/comments");
          if (!response.ok) {
            throw new Error("Failed to fetch comments");
          }
          const comments = await response.json();
          console.log(comments);
          displayComments(comments);
        } catch (error) {
          errorMessage.textContent = error.message;
          errorMessage.classList.remove('hidden');
        } finally {
          loadingMessage.classList.add('hidden');
        }
      }

      function displayComments(comments) {
        const filteredComments = comments.filter(comment => comment.filter === false);
        jobsCount.textContent = `${filteredComments.length} jobs`;
        jobsCount.classList.remove('hidden');

        filteredComments.forEach(comment => {
          const commentDiv = document.createElement('div');
          commentDiv.className = "rounded-lg p-4 mb-4 bg-zinc-800 shadow-md";

          const date = new Date(comment.time * 1000).toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
            hour: "2-digit",
            minute: "2-digit",
          });

          const commentText = comment.source === 'indeed' ? marked.parse(comment.text) : comment.text;

          commentDiv.innerHTML = `
            <p class="text-sm text-zinc-400">${date}</p>
            <div class="mt-2 text-zinc-200">${commentText}</div>
            <a href="${comment.url}" 
              class="text-blue-800 hover:underline" 
              target="_blank" rel="noopener noreferrer">
              ${comment.source === 'hackernews' ? 'View on Hacker News' : 'View on Indeed'}
            </a>
          `;
          commentsContainer.appendChild(commentDiv);
        });
      }

      fetchComments();
    });
  </script>

</body>

</html>